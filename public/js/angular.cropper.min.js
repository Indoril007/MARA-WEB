!function(a,b){"use strict";function c(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.lcfirst=function(){return this.charAt(0).toLowerCase()+this.slice(1)};var d=a.module("bp.img.cropper",[]);d.constant("CroppableDefaults",{aspectRatio:0,ruleOfThirds:!0,outputType:"base64",widthMin:50,widthMax:0,heightMin:50,heightMax:0,autoCropping:!0,imageType:"jpeg",centerHandles:!0,sizeHint:!0,loadingClass:"cropper-loading",backdropOpacity:50,eventPrefix:"crop",optionsPrefix:"crop",directiveName:"$croppable",preloader:!0,lockDimensions:!1}),d.controller("CroppableController",["$scope","$element","$attrs","$compile","$parse","$q","$log","$window","$document","$timeout","$interpolate","CroppableDefaults",function(d,e,f,g,h,i,j,k,l,m,n,o){function p(b){return a.isDefined(fa.$cropper)&&(P(),R(),V(),fa.$hasSelection=N(),T(b),s(),t(),T("onUpdate")),fa}function q(){ha.imgSrc=f.ngSrc,e.wrap('<div class="crop-it-container"></div>'),fa.$cropContainer=e.parent().prepend(r()),fa.$cropper=a.element(fa.$cropContainer[0].querySelector(".cropper")),fa.$cropArea=a.element(fa.$cropper[0].querySelector(".crop-area")),fa.$overlayedImg=a.element(fa.$cropArea[0].querySelector("img")),fa.$cropHandles=a.element(fa.$cropper[0].querySelector(".crop-handles")),fa.$centerHandles=a.element(fa.$cropHandles[0].querySelectorAll(".center-handle")),fa.$sizeHint=a.element(fa.$cropper[0].querySelector(".size-hint")),fa.$ruleOfThirds=a.element(fa.$cropArea[0].querySelectorAll(".rule-of-thirds"))}function r(){var b="";return b+='<span ng-if="options.preloader" class="crop-loader"><span class="crop-loader-inner"></span></span>',b+='<div class="cropper" style="display: none;">',b+='<div class="crop-area">',b+='<img ng-src="{{ imgSrc }}">',b+='<span class="rule-of-thirds vertical-1"></span>',b+='<span class="rule-of-thirds vertical-2"></span>',b+='<span class="rule-of-thirds horizontal-1"></span>',b+='<span class="rule-of-thirds horizontal-2"></span>',b+="</div>",b+='<div class="crop-handles">',b+='<div class="handle top-left"></div>',b+='<div class="handle center-handle top"></div>',b+='<div class="handle top-right"></div>',b+='<div class="handle center-handle right"></div>',b+='<div class="handle bottom-right"></div>',b+='<div class="handle center-handle bottom"></div>',b+='<div class="handle bottom-left"></div>',b+='<div class="handle center-handle left"></div>',b+="</div>",b+='<span class="size-hint"></span>',b+="</div>",b=a.element(b),ha.options=ba,g(b)(ha)}function s(){fa.$cropper.css({display:fa.$active&&fa.$hasSelection?"block":"none",top:fa.$measurements.top+"px",left:fa.$measurements.left+"px",width:fa.$measurements.width+"px",height:fa.$measurements.height+"px"}),fa.$overlayedImg.css({width:e[0].offsetWidth+"px",height:e[0].offsetHeight+"px",top:"-"+fa.$measurements.top+"px",left:"-"+fa.$measurements.left+"px"}),e.css({opacity:fa.$active&&fa.$hasSelection?ba.backdropOpacity/100:"1"}),fa.$sizeHint.text(Math.round(fa.$data.width)+"x"+Math.round(fa.$data.height)).css({opacity:ba.sizeHint&&fa.$selecting&&fa.$hasSelection?1:0}),fa.$ruleOfThirds.css({display:ba.ruleOfThirds&&fa.$hasSelection?"block":"none"})}function t(){fa.$cropHandles.css({display:fa.$hasSelection&&!fa.$selecting&&!fa.$moving&&fa.$active&&ba.lockDimensions===!1?"block":"none"}),fa.$centerHandles.css({display:ba.centerHandles&&ba.lockDimensions===!1?"block":"none"})}function u(c){e.off("$destroy",u),a.isDefined(c)&&a.isDefined(fa.$name)&&delete h(ba.directiveName)(d)[fa.$name],a.isDefined(fa.$cropContainer)&&(D(!0),a.isUndefined(f.ngSrc)&&a.isUndefined(c)&&(e.removeAttr("src"),e.attr("ng-src",fa.$srcAttr)),fa.$cropContainer.replaceWith(e),fa.$cropContainer=b,fa.$cropper=b,fa.$cropArea=b,fa.$cropHandles=b,fa.$overlayedImg=b,fa.$centerHandles=b,fa.$sizeHint=b,fa.$ruleOfThirds=b),a.forEach(ma,function(a){a()}),w(),y(),la||(B(),ka=fa.$initialized=!1),fa.$data.base64=null,T("onDestroy")}function v(){ca=d.$watch(f.croppable,function(b,c){b!==c&&a.isDefined(b)&&!la&&(a.isObject(b)?(b.width&&c.width&&b.width!==c.width?ia=!0:b.height&&c.height&&b.height!==c.height&&(ja=!0),fa.$data.top=b.top||fa.$data.top,fa.$data.left=b.left||fa.$data.left,fa.$data.width=b.width||fa.$data.width,fa.$data.height=b.height||fa.$data.height,Q(),p(),ia=!1,ja=!1):j.warn("The new value in the "+(f.croppable+" variable "||"croppable attribute ")+"is not an object!"))},!0)}function w(){return a.isUndefined(ca)?!1:(ca(),ca=b,!0)}function x(){da=d.$watch(f[ba.optionsPrefix+"Options"],function(b,c){b!==c&&a.isDefined(b)?(X(b),b.lockDimensions!==c.lockDimensions&&fa.$active&&(D(!0),C())):b!==c&&a.isUndefined(b)&&X(o)},!0)}function y(){return a.isUndefined(da)?!1:(da(),da=b,!0)}function z(){v(),f.hasOwnProperty(ba.optionsPrefix+"Show")&&O(f[ba.optionsPrefix+"Show"],function(a,b){a===b||"boolean"!=typeof a||a===b||la||(a===!1?D():C())}),f.hasOwnProperty(ba.optionsPrefix+"LockDimensions")&&O(f[ba.optionsPrefix+"LockDimensions"],function(a,b){a!==b&&"boolean"==typeof a&&m(function(){X("lockDimensions",a),fa.$active===!0&&(D(!0),C())})}),f.hasOwnProperty(ba.optionsPrefix+"Options")&&x(),O(function(){return fa.$loading},function(b,c){b!==c&&a.isDefined(fa.$cropContainer)&&ba.preloader&&fa.$cropContainer.toggleClass(ba.loadingClass,b)})}function A(){ea=f.$observe("ngSrc",function(b){if(ka){if(la=!0,a.isUndefined(b))return u(),void(la=!1);a.isUndefined(ca)&&(X(d.$eval(f[ba.optionsPrefix+"Options"])),z()),D(!0),ha.imgSrc=b,W().then(function(){$(a.isUndefined(d.$eval(f.croppable))?{width:0,height:0,left:0,top:0}:a.extend({},fa.$data,d.$eval(f.croppable))),la=!1,C()})}})}function B(){return a.isUndefined(ea)?!1:(ea(),ea=b,!0)}function C(){if(fa.$active===!1&&a.isDefined(f.ngSrc)){if(a.isDefined(f[ba.optionsPrefix+"Show"])&&!!d.$eval(f[ba.optionsPrefix+"Show"])==!1)return fa;a.isUndefined(fa.$cropContainer)&&q(),fa.$active=!0,ba.lockDimensions===!1&&(fa.$cropContainer.on("touchstart mousedown",E).addClass("crop-active"),fa.$cropHandles.children().on("touchstart mousedown",J)),fa.$cropper.on("touchstart mousedown",H),a.element(k).on("resize",K),f.hasOwnProperty(ba.optionsPrefix+"Show")&&h(f[ba.optionsPrefix+"Show"]).assign(d,!0),p("onEnable")}return fa}function D(b){return fa.$active===!0&&(fa.$active=!1,fa.$cropContainer.off("touchstart mousedown",E).removeClass("crop-active"),fa.$cropHandles.children().off("touchstart mousedown",J),fa.$cropper.off("touchstart mousedown",H),a.element(k).off("resize",K),f.hasOwnProperty(ba.optionsPrefix+"Show")&&b!==!0&&h(f[ba.optionsPrefix+"Show"]).assign(d,!1),p("onDisable")),fa}function E(b){2!==b.button&&(b.preventDefault(),a.element(k).on("touchend mouseup",G),a.element(k).on("touchmove mousemove",F),_=M(b),fa.$selecting=!0,fa.$measurements.top=0,fa.$measurements.left=0,fa.$measurements.width=0,fa.$measurements.height=0,fa.$data.base64=null,p("onSelectStart"))}function F(a){if(fa.$selecting){a.preventDefault(),aa=M(a);var b=aa.x-_.x,c=aa.y-_.y;ba.aspectRatio&&ia?(c=c>0?Math.min(e[0].offsetHeight-_.y,Math.abs(Math.round(b/ba.aspectRatio))):Math.min(_.y,Math.abs(Math.round(b/ba.aspectRatio))),b=c*ba.aspectRatio):ba.aspectRatio&&ja&&(b=b>0?Math.min(e[0].offsetWidth-_.x,Math.abs(c*ba.aspectRatio)):Math.min(_.x,Math.abs(c*ba.aspectRatio)),c=b/ba.aspectRatio),fa.$measurements.left=aa.x-_.x>0||!ia?_.x:Math.max(0,_.x-Math.abs(b)),fa.$measurements.top=aa.y-_.y>0||!ja?_.y:Math.max(0,_.y-Math.abs(c)),ba.aspectRatio||ia&&ja?(fa.$measurements.width=Math.abs(b),fa.$measurements.height=Math.abs(c)):ia?fa.$measurements.width=Math.abs(b):ja&&(fa.$measurements.height=Math.abs(c)),p("onSelect")}}function G(c){c.stopPropagation(),ia=!0,ja=!0,a.element(k).off("touchend mouseup",G),fa.$moving?(a.element(k).off("touchmove mousemove",I),fa.$moving=!1,p("onMoveEnd")):fa.$selecting&&(a.element(k).off("touchmove mousemove",F),fa.$selecting=!1,p("onSelectEnd"),aa=b)}function H(b){if(2!==b.button&&(b.stopPropagation(),b.preventDefault(),!fa.$moving)){a.element(k).on("touchmove mousemove",I),a.element(k).on("touchend mouseup",G);var c=M(b);fa.$moving=!0,ga.posX=c.x-fa.$cropper[0].offsetLeft,ga.posY=c.y-fa.$cropper[0].offsetTop,p("onMoveStart")}}function I(a){fa.$data.base64=null;var b=M(a);fa.$measurements.left=Math.max(0,Math.min(b.x-ga.posX,e[0].offsetWidth-fa.$cropper[0].offsetWidth)),fa.$measurements.top=Math.max(0,Math.min(b.y-ga.posY,e[0].offsetHeight-fa.$cropper[0].offsetHeight)),p("onMove")}function J(b){if(2!==b.button){b.preventDefault(),b.stopPropagation();var c=a.element(b.target);fa.$selecting=!0,c.hasClass("top-left")?(_.x=fa.$measurements.left+fa.$measurements.width,_.y=fa.$measurements.top+fa.$measurements.height):c.hasClass("top")?(ia=!1,_.x=fa.$measurements.left,_.y=fa.$measurements.top+fa.$measurements.height):c.hasClass("top-right")?(_.x=fa.$measurements.left,_.y=fa.$measurements.top+fa.$measurements.height):c.hasClass("right")?(ja=!1,_.x=fa.$measurements.left,_.y=fa.$measurements.top):c.hasClass("bottom-right")?(_.x=fa.$measurements.left,_.y=fa.$measurements.top):c.hasClass("bottom")?(ia=!1,_.x=fa.$measurements.left,_.y=fa.$measurements.top):c.hasClass("bottom-left")?(_.x=fa.$measurements.left+fa.$measurements.width,_.y=fa.$measurements.top):c.hasClass("left")&&(ja=!1,_.x=fa.$measurements.left+fa.$measurements.width,_.y=fa.$measurements.top),a.element(k).on("touchmove mousemove",F),a.element(k).on("touchend mouseup",G)}}function K(){Q(),p()}function L(a){var b=a[0].getBoundingClientRect();return{top:b.top+k.pageYOffset-l[0].documentElement.clientTop,left:b.left+k.pageXOffset-l[0].documentElement.clientLeft}}function M(a){var b=a.touches&&a.touches.length?a.touches:[a],c=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0],d=L(e),f=c.pageX-d.left,g=c.pageY-d.top;return{x:Math.max(0,Math.min(f,e[0].offsetWidth)),y:Math.max(0,Math.min(g,e[0].offsetHeight))}}function N(){return fa.$measurements.width>0||fa.$measurements.height>0}function O(a,b,c){var e=d.$watch(a,b,c||!1);ma.push(e)}function P(){fa.$imgInfo.scaleRatio=Math.min(fa.$imgInfo.originalWidth/e[0].offsetWidth,fa.$imgInfo.originalHeight/e[0].offsetHeight),fa.$data.top=fa.$measurements.top*fa.$imgInfo.scaleRatio,fa.$data.left=fa.$measurements.left*fa.$imgInfo.scaleRatio,fa.$data.width=fa.$measurements.width*fa.$imgInfo.scaleRatio,fa.$data.height=fa.$measurements.height*fa.$imgInfo.scaleRatio}function Q(){fa.$imgInfo.scaleRatio=Math.min(fa.$imgInfo.originalWidth/e[0].offsetWidth,fa.$imgInfo.originalHeight/e[0].offsetHeight),fa.$measurements.top=fa.$data.top/fa.$imgInfo.scaleRatio,fa.$measurements.left=fa.$data.left/fa.$imgInfo.scaleRatio,fa.$measurements.width=fa.$data.width/fa.$imgInfo.scaleRatio,fa.$measurements.height=fa.$data.height/fa.$imgInfo.scaleRatio}function R(){var a,c,d=ba.heightMax?ba.heightMax/fa.$imgInfo.scaleRatio:b,f=ba.widthMax?ba.widthMax/fa.$imgInfo.scaleRatio:b,g=ba.heightMin?ba.heightMin/fa.$imgInfo.scaleRatio:b,h=ba.widthMin?ba.widthMin/fa.$imgInfo.scaleRatio:b;N()&&(ba.aspectRatio&&ia?fa.$measurements.height=fa.$measurements.width/ba.aspectRatio:ba.aspectRatio&&ja&&(fa.$measurements.width=fa.$measurements.height*ba.aspectRatio),f&&fa.$measurements.width>f&&f>h&&!fa.$moving&&(fa.$measurements.width=f,fa.$measurements.height=ba.aspectRatio?d:fa.$measurements.height,fa.$measurements.top=aa&&aa.y-_.y<0?_.y-fa.$measurements.height:fa.$measurements.top,fa.$measurements.left=aa&&aa.x-_.x<0?_.x-fa.$measurements.width:fa.$measurements.left),d&&fa.$measurements.height>d&&d>g&&!fa.$moving&&(fa.$measurements.height=d,fa.$measurements.width=ba.aspectRatio?f:fa.$measurements.width,fa.$measurements.top=aa&&aa.y-_.y<0?_.y-fa.$measurements.height:fa.$measurements.top),!fa.$selecting&&h&&fa.$measurements.width<h&&(fa.$measurements.width=h,fa.$measurements.height=ba.aspectRatio?g:fa.$measurements.height),!fa.$selecting&&g&&fa.$measurements.height<g&&(fa.$measurements.height=g,fa.$measurements.width=ba.aspectRatio?h:fa.$measurements.width),c=e[0].offsetWidth-(fa.$measurements.left+fa.$measurements.width),a=e[0].offsetHeight-(fa.$measurements.top+fa.$measurements.height),0>c&&(fa.$measurements.width=fa.$measurements.left+c<0?e[0].offsetWidth:fa.$measurements.width,fa.$measurements.left=fa.$measurements.left+c<0?0:fa.$measurements.left+c),0>a&&(fa.$measurements.height=fa.$measurements.top+a<0?e[0].offsetHeight:fa.$measurements.height,fa.$measurements.top=fa.$measurements.top+a<0?0:fa.$measurements.top+a),P())}function S(){ba.aspectRatio&&ba.widthMax?ba.heightMax=ba.widthMax/ba.aspectRatio:ba.aspectRatio&&ba.heightMax&&(ba.widthMax=ba.heightMax*ba.aspectRatio),ba.aspectRatio&&ba.widthMin?ba.heightMin=ba.widthMin/ba.aspectRatio:ba.aspectRatio&&ba.heightMin&&(ba.widthMin=ba.heightMin*ba.aspectRatio),m(function(){var a=y();a&&(h(f[ba.optionsPrefix+"Options"]).assign(d,ba),x())})}function T(e){var g=a.isString(e)?e:b;return a.isUndefined(g)||c(na,g)===!1?!1:void m(function(){var a=null!==e.match(/\^?before/)&&"before"===e.match(/\^?before/)[0]?e:e.replace(/\^?on/,"").lcfirst();fa[g](),d.$emit(ba.eventPrefix+"."+a,fa.$data,fa,d.$eval(f.cropData))},0)}function U(){m(function(){var a={width:Math.round(fa.$data.width),height:Math.round(fa.$data.height),top:Math.round(fa.$data.top),left:Math.round(fa.$data.left),base64:fa.$data.base64};w(),h(f.croppable).assign(d,a),ka&&v()})}function V(){var a,b;if(!la)if(fa.$selecting||fa.$moving||!N())U();else if(ba.autoCropping){a=l[0].createElement("canvas"),a.width=fa.$data.width,a.height=fa.$data.height,b=a.getContext("2d"),b.drawImage(e[0],fa.$data.left,fa.$data.top,fa.$data.width,fa.$data.height,0,0,fa.$data.width,fa.$data.height);try{fa.$data.base64=a.toDataURL("image/"+ba.imageType)}catch(c){j.error(c.message)}finally{return U(),fa.$data.base64}}}function W(){T("beforeImageLoad"),fa.$loading=!0;var a=i.defer(),b=new Image;return b.onload=function(){fa.$data.base64=null,fa.$imgInfo.originalWidth=b.width,fa.$imgInfo.originalHeight=b.height,a.resolve(),fa.$loading=!1,T("onImageLoad")},b.src=f.ngSrc,a.promise}function X(b,c){if(b=b||o,a.isObject(b))ba=a.extend({},o,b);else if(a.isDefined(c)&&a.isString(b))ba[b]=c;else if(a.isString(b)&&a.isUndefined(c))return ba[b];return S(),la||p(),fa}function Y(){a.forEach(na,function(b){a.isDefined(f[ba.optionsPrefix+b.ucfirst()])?fa[b]=function(){d.$eval(f[ba.optionsPrefix+b.ucfirst()],{$data:fa.$data,$croppable:fa})}:fa[b]=a.noop})}function Z(){return N()&&(fa.$data={top:0,left:0,width:0,height:0,base64:null},Q(),p("onReset")),fa}function $(b,c){return a.isUndefined(b)?fa:(a.isArray(b)?(fa.$data.top=a.isDefined(b[0])&&a.isNumber(b[0])?b[0]:fa.$data.top,fa.$data.left=a.isDefined(b[1])&&a.isNumber(b[1])?b[1]:fa.$data.left,fa.$data.width=a.isDefined(b[2])&&a.isNumber(b[2])?b[2]:fa.$data.width,fa.$data.height=a.isDefined(b[3])&&a.isNumber(b[3])?b[3]:fa.$data.height):a.isObject(b)?fa.$data=a.extend({},fa.$data,b):a.isString(b)&&a.isNumber(c)&&(fa.$data[b]=c),Q(),_={x:fa.$measurements.left,y:fa.$measurements.top},R(),fa)}var _,aa,ba,ca,da,ea,fa=this,ga={},ha=d.$new(!0),ia=!0,ja=!0,ka=!1,la=!1,ma=[],na=["onSelectStart","onSelect","onSelectEnd","onMoveStart","onMove","onMoveEnd","onEnable","onDisable","onReset","onUpdate","onDestroy","onReady","beforeImageLoad","onImageLoad"];fa.$name,fa.$selecting=!1,fa.$moving=!1,fa.$loading=!1,fa.$measurements={top:0,left:0,width:0,height:0},fa.$data={top:0,left:0,width:0,height:0,base64:null},fa.$imgInfo={},fa.$active=!1,fa.$hasSelection=!1,fa.$initialized=!1,fa.$cropContainer,fa.$cropper,fa.$cropArea,fa.$overlayedImg,fa.$cropHandles,fa.$centerHandles,fa.$sizeHint,fa.$ruleOfThirds,e.on("$destroy",u),fa.$options=X,fa.$clear=Z,fa.$toggle=function(){return fa.$active?fa.disableCrop():fa.enableCrop()},fa.$cropIt=function(b,c){return a.isDefined(b)?void fa.setArea(b,c):fa.makeCropData()},fa.$destroy=function(){return u(),fa},fa.$init=function(b){return ka?void j.info("The cropper has already been initialized!"):(X(b),Y(),a.isDefined(f.ngSrc)?W().then(function(){$(d.$eval(f.croppable)),C(),z(),A(),T("onReady"),m(function(){ka=fa.$initialized=!0})}):(A(),m(function(){ka=fa.$initialized=!0})),fa)}}]),d.directive("croppable",["$parse","$interpolate","CroppableDefaults",function(b,c,d){return{restict:"A",priority:100,controller:"CroppableController",link:{pre:function(a,b,c,d){d.$srcAttr=c.ngSrc},post:function(e,f,g,h){if("IMG"!==f[0].tagName)throw"The croppable element must be an image tag!";if(!g.hasOwnProperty("ngSrc")&&!g.hasOwnProperty("src"))throw"The image tag has no ngSrc or src attribute, croppable directive can't function without this";var i={};g.hasOwnProperty("cropOptions")&&a.isDefined(g.cropOptions)&&a.isObject(e.$eval(g.cropOptions))&&(i=a.extend(i,e.$eval(g.cropOptions)));for(var j in d)a.isDefined(e.$eval(g[d.optionsPrefix+j.ucfirst()]))&&(i[j]=e.$eval(g[d.optionsPrefix+j.ucfirst()]));h.$init(i),g.hasOwnProperty(h.$options("optionsPrefix")+"Name")&&a.isString(g[h.$options("optionsPrefix")+"Name"])&&(h.$name=c(g[h.$options("optionsPrefix")+"Name"])(e),b(d.directiveName+"."+h.$name).assign(e,h))}}}}])}(window.angular);